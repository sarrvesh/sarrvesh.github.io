

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Sky Model Construction Using Shapelets &mdash; LOFAR Imaging Cookbook 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="LOFAR Imaging Cookbook 0.0.1 documentation" href="index.html"/>
        <link rel="next" title="SAGECAL" href="sagecal.html"/>
        <link rel="prev" title="Black-Board Selfcal (BBS)" href="bbs.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> LOFAR Imaging Cookbook
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting started </a></li>
<li class="toctree-l1"><a class="reference internal" href="datainspection.html">Data inspection </a></li>
<li class="toctree-l1"><a class="reference internal" href="aoflagger.html">AOFlagger </a></li>
<li class="toctree-l1"><a class="reference internal" href="dppp.html">The Default Pre-Processing Pipeline (DPPP) </a></li>
<li class="toctree-l1"><a class="reference internal" href="dpppcalibrate.html">Gain calibration with DPPP </a></li>
<li class="toctree-l1"><a class="reference internal" href="losoto.html">LoSoTo: LOFAR Solution Tool </a></li>
<li class="toctree-l1"><a class="reference internal" href="wsclean.html">The WSClean Imager </a></li>
<li class="toctree-l1"><a class="reference internal" href="sourcedetection.html">Source detection and sky model manipulation: PyBDSF and LSMTool </a></li>
<li class="toctree-l1"><a class="reference internal" href="factor.html">Factor: Facet Calibration for LOFAR </a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Practical examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Useful resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="bbs.html">Black-Board Selfcal (BBS)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Sky Model Construction Using Shapelets </a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#software-overview">Software overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modkey">modkey</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fitscopy">fitscopy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ds9-and-kvis">ds9 and kvis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#duchamp">Duchamp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buildsky">buildsky</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restore">restore</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shapelet-gui">shapelet_gui</a></li>
<li class="toctree-l3"><a class="reference internal" href="#convert-skymodel-py">convert_skymodel.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-clusters-py">create_clusters.py</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-by-step-example">Step by Step Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initial-point-source-model">Initial point source model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initial-shaplet-model">Initial shaplet model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-both-shapelets-and-point-sources-together">Using both shapelets and point sources together</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation">Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calibration">Calibration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#residual">Residual</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recalibration">Recalibration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conclusions">Conclusions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sagecal.html">SAGECAL </a></li>
<li class="toctree-l1"><a class="reference internal" href="awimager.html">The AW Imager </a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">LOFAR Imaging Cookbook</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Sky Model Construction Using Shapelets </li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/shapelets.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sky-model-construction-using-shapelets">
<h1>Sky Model Construction Using Shapelets <a class="footnote-reference" href="#f1" id="id1">[1]</a><a class="headerlink" href="#sky-model-construction-using-shapelets" title="Permalink to this headline">¶</a></h1>
<p>In this chapter, we give a tutorial overview of sky model construction using shapelets and other source types suitable for self calibration. Note that shapelets decomposition should be used in the case we are dealing with extended sources.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial, we present construction of accurate and efficient sky models for calibration of LOFAR data, using shapelets. However, we do not present any theoretical material on shapelets and their strengths and weaknesses for use in self calibration. We refer the reader to Yatawatta (2010; 2011) for a more mathematical presentation on these subjects.</p>
<p>We always work with FITS images for our model construction. Therefore, it is assumed that you already have an image of the sky that is being observed, which is good enough to create a sky model from. You can obtain a FITS image of the sky that is being observed in many ways. For example, you can use images made by other instruments (at a probably different frequency/resolution) and one such source is <a class="reference external" href="http://skyview.gsfc.nasa.gov/cgi-bin/skvadvanced.pl">Sky View</a>. You can also do a rough calibration of the data and make a preliminary image of the sky. And if you are hardcore, you can also manipulate an empty FITS file to create the shape that you want to model (we shall discuss this later).</p>
<p>The FITS file contains more information than that is shown as the image. Since we are dealing with images made with radio interferometers, almost all images have been deconvolved (e.g. by CLEAN). The Point Spread Function (PSF) plays an important role in deconvolution. Most FITS files have information about the approximate PSF that we will be using a lot. This information is stored in the header of the FITS file with the keywords <strong>BMAJ</strong>, <strong>BMIN</strong>, and <strong>BPA</strong>. The <strong>BMAJ</strong> and <strong>BMIN</strong> keywords give the PSF width as the major and minor axes of a Gaussian. The <strong>BPA</strong> keyword gives the position angle (or the rotation) of the Gaussian. We will learn how to manipulate these keywords (or add them if your FITS file is without them) later.</p>
<p>Throughout this tutorial, we will calibrate an observation of Virgo-A around 50 MHz. In Fig. ref{shp:viravla}, we have shown an image of Virgo-A made by the VLA at 74 MHz. The red circle on top right corner shows the PSF for this image. Although the frequency and resolution does not match the LOFAR observation, we will be using this image to build a sky model.</p>
<div class="figure align-center" id="id3">
<img alt="_images/vira_74vla.png" src="_images/vira_74vla.png" />
<p class="caption"><span class="caption-text">Virgo-A image made by the VLA at 74 MHz. The red circle on top right corner is the PSF.</span></p>
</div>
<p>Looking closer at Fig. ref{shp:viravla}, we see that there is bright compact structure at the center and weak diffuse structure surrounding it. You should always keep in mind the golden rule in source modeling: A point source is best modeled by a point source and nothing else. Almost always, you will have images with both compact structure (best modeled by point sources) and extended structure (best modeled using shapelets). In our example, we need to model the central compact structure as point sources and the remainder as shapelets. See Yatawatta (2010) for a theoretical explanation.</p>
</div>
<div class="section" id="software-overview">
<h2>Software overview<a class="headerlink" href="#software-overview" title="Permalink to this headline">¶</a></h2>
<p>There are several steps needed in building a good sky model. You can skip some steps depending on particular requirements (and if you can use other software to do the same). We give a general overview of various tools used in different stages of sky model construction. All the software is installed in <strong>/opt/cep/shapelet/bin</strong> in the CEP clusters.</p>
<div class="section" id="modkey">
<h3>modkey<a class="headerlink" href="#modkey" title="Permalink to this headline">¶</a></h3>
<p>The program <strong>modkey</strong> is used to modify keywords in FITS files. For example, if you want to modify the <strong>BMAJ</strong> keyword in the <strong>example.fits</strong> FITS file</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">modkey</span> <span class="o">-</span><span class="n">f</span> <span class="n">example</span><span class="o">.</span><span class="n">fits</span> <span class="o">-</span><span class="n">k</span> <span class="n">BMAJ</span> <span class="o">-</span><span class="n">d</span> <span class="mf">0.1</span>
</pre></div>
</div>
<p>will set the value of <strong>BMAJ</strong> to <span class="math">\(0.1\)</span>. If this key does not exist, it will be created. Try using</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">modkey</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>for more usage examples.</p>
</div>
<div class="section" id="fitscopy">
<h3>fitscopy<a class="headerlink" href="#fitscopy" title="Permalink to this headline">¶</a></h3>
<p>Most FITS files will be too large to work with. The sources that you want to model will be only in small areas of the large FITS file. The program <strong>fitscopy</strong> will create a smaller FITS file by selecting a smaller rectangle from the larger FITS file. For example, if you want to select the area given by the pixels <span class="math">\([x0,y0]\)</span> bottom left hand corner and <span class="math">\([x1,y1]\)</span> top right hand corner of the file <strong>large.fits</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">fitscopy</span> <span class="n">large</span><span class="o">.</span><span class="n">fits</span> <span class="n">small</span><span class="o">.</span><span class="n">fits</span> <span class="n">x0</span> <span class="n">y0</span> <span class="n">x1</span> <span class="n">y1</span>
</pre></div>
</div>
<p>will do the trick.</p>
</div>
<div class="section" id="ds9-and-kvis">
<h3>ds9 and kvis<a class="headerlink" href="#ds9-and-kvis" title="Permalink to this headline">¶</a></h3>
<p>We use both <strong>ds9</strong> and <strong>kvis</strong> to display FITS file as well as display regions (<strong>ds9</strong>) and annotations (<strong>kvis</strong>).</p>
</div>
<div class="section" id="duchamp">
<h3>Duchamp<a class="headerlink" href="#duchamp" title="Permalink to this headline">¶</a></h3>
<p>The source extraction program <strong>Duchamp</strong> is written by <a class="reference external" href="http://www.atnf.csiro.au/people/Matthew.Whiting/Duchamp/">Matthew Whiting</a>. We will only be using <strong>Duchamp</strong> to create a mask file for a given FITS image. A mask is a FITS file with the same size as the original image, but with zeros everywhere except at the selected pixels. Here is a simple configuration file for creating a mask for <strong>example.fits</strong> FITS file</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">##########################################</span>
<span class="n">imageFile</span> <span class="n">example</span><span class="o">.</span><span class="n">fits</span>
<span class="n">logFile</span>         <span class="n">logfile</span><span class="o">.</span><span class="n">txt</span>
<span class="n">outFile</span>         <span class="n">results</span><span class="o">.</span><span class="n">txt</span>
<span class="n">spectraFile</span>     <span class="n">spectra</span><span class="o">.</span><span class="n">ps</span>
<span class="n">minPix</span>          <span class="mi">5</span>
<span class="n">flagATrous</span>      <span class="mi">0</span>
<span class="n">snrRecon</span>        <span class="mf">10.</span>
<span class="n">snrCut</span>          <span class="mf">5.</span>
<span class="n">threshold</span> <span class="mf">0.030</span>
<span class="n">minChannels</span>     <span class="mi">3</span>
<span class="n">flagBaseline</span>    <span class="mi">0</span>
<span class="n">flagKarma</span> <span class="mi">1</span>
<span class="n">karmaFile</span> <span class="n">duchamp</span><span class="o">.</span><span class="n">ann</span>
<span class="n">flagnegative</span> <span class="mi">0</span>
<span class="n">flagMaps</span> <span class="mi">0</span>
<span class="n">flagOutputMask</span> <span class="mi">1</span>
<span class="n">flagMaskWithObjectNum</span> <span class="mi">1</span>
<span class="n">flagXOutput</span> <span class="mi">0</span>
<span class="c1">############################################</span>
</pre></div>
</div>
<p>The threshold for pixel selection is given by the <strong>threshold</strong> parameter which is <span class="math">\(0.03\)</span> in the above example. After creating the configuration file, and saving it as <strong>myconf.txt</strong>, you can run <strong>Duchamp</strong> as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Duchamp</span> <span class="o">-</span><span class="n">p</span> <span class="n">myconf</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>This will create a mask file called <strong>example.MASK.fits</strong> which we will be using at later stages.</p>
<p>NOTE: Only versions later than 1.1.9 produce the right output.</p>
</div>
<div class="section" id="buildsky">
<h3>buildsky<a class="headerlink" href="#buildsky" title="Permalink to this headline">¶</a></h3>
<p>We mentioned before that whenever we have compact structure, it is best modeled by using point sources. The program <strong>buildsky</strong> creates a model with only point sources for a given image. However, we must have a mask file. So if we have <strong>example.fits</strong> image and <strong>example.MASK.fits</strong> mask file, the simplest way of using this is</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">buildsky</span> <span class="o">-</span><span class="n">f</span> <span class="n">example</span><span class="o">.</span><span class="n">fits</span> <span class="o">-</span><span class="n">m</span> <span class="n">example</span><span class="o">.</span><span class="n">MASK</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<p>This will create a file called <strong>example.fits.sky.txt</strong> that can be used as input for BBS. It also creates a <strong>ds9</strong> region file called <strong>example.fits.ds9.reg</strong> that you can use to check your sky model.</p>
<p>You can see other options by typing</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">buildsky</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
</div>
<div class="section" id="restore">
<h3>restore<a class="headerlink" href="#restore" title="Permalink to this headline">¶</a></h3>
<p>We use <strong>restore</strong> to restore a sky model onto a FITS file. The sky model can be specified in two different ways. It can directly read a BBS sky model like</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Name, Type, Ra, Dec, I, Q, U, V, MajorAxis, MinorAxis, Orientation,</span>
<span class="c1"># ReferenceFrequency, SpectralIndex= with &#39;[]&#39;</span>
<span class="c1"># NOTE: no default values taken, for point sources</span>
<span class="c1">#  major,minor,orientation has to be all zero</span>
<span class="c1"># Example:</span>
<span class="c1"># note: bmaj,bmin, Gaussian radius in degrees, bpa also in degrees</span>
<span class="n">Gtest1</span><span class="p">,</span> <span class="n">GAUSSIAN</span><span class="p">,</span> <span class="mi">18</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mf">16.309</span><span class="p">,</span> <span class="o">-</span><span class="mf">22.46</span><span class="o">.</span><span class="mf">26.616</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.222</span><span class="p">,</span> <span class="mf">0.111</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">150e6</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
<span class="n">Ptest2</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="mi">18</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mf">20.309</span><span class="p">,</span> <span class="o">-</span><span class="mf">22.53</span><span class="o">.</span><span class="mf">16.616</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">140e6</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.100</span><span class="p">]</span>
</pre></div>
</div>
<p>and also it can read an LSM sky model like (see chapter on SAGECAL for more information)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">## this is an LSM text (hms/dms) file</span>
<span class="c1">## fields are (where h:m:s is RA, d:m:s is Dec):</span>
<span class="c1">## name h m s d m s I Q U V spectral_index RM</span>
<span class="c1">##    extent_X(rad) extent_Y(rad) pos_angle(rad) freq0</span>
<span class="n">P1C1</span> <span class="mi">1</span> <span class="mi">35</span> <span class="mf">29.128</span> <span class="mi">84</span> <span class="mi">21</span> <span class="mf">51.699</span> <span class="mf">0.061585</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mf">1000000.0</span>
</pre></div>
</div>
<p>using <strong>-o 0</strong> for BBS and <strong>-o 1</strong> or <strong>-o 1</strong> for LSM. Note that <strong>buildsky</strong> will now (version 0.0.6) only produce LSM with 3rd order spectra.  Spectral indices use natural logarithm, <span class="math">\(\exp(ln(I_0) + p1*ln(f/f_0) + p2*ln(f/f_0)^2 + \ldots)\)</span> so if you have a model with common logarithms like</p>
<div class="math">
\[10^{(\log(J_0) + q1*\log(f/f_0) + q2*\log(f/f_0)^2 + \ldots)}\]</div>
<p>then, conversion is <span class="math">\(I_0=J_0\)</span>, <span class="math">\(p1=q1\)</span>, <span class="math">\(p2=q2/\ln(10)\)</span>, <span class="math">\(p3=q3/(\ln(10)^2)\)</span> and so on.</p>
<p>As you can see, both above sky models are the same. In addition, the LSM sky model can be used to represent Gaussians (name starting with  <strong>G</strong>), disks (name starting with <strong>D</strong>) and rings (name starting with <strong>R</strong>).</p>
<p>Once you have such a sky model (text file <strong>sky.txt</strong>), and a FITS file called <strong>example.fits</strong>, you can do many things</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">restore</span> <span class="o">-</span><span class="n">f</span> <span class="n">example</span><span class="o">.</span><span class="n">fits</span> <span class="o">-</span><span class="n">i</span> <span class="n">sky</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>will replace the FITS file with the sky model, so the original image will be overwritten;</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">restore</span> <span class="o">-</span><span class="n">f</span> <span class="n">example</span><span class="o">.</span><span class="n">fits</span> <span class="o">-</span><span class="n">i</span> <span class="n">sky</span><span class="o">.</span><span class="n">txt</span>  <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
<p>will add the sky model to the image; and</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">restore</span> <span class="o">-</span><span class="n">f</span> <span class="n">example</span><span class="o">.</span><span class="n">fits</span> <span class="o">-</span><span class="n">i</span> <span class="n">sky</span><span class="o">.</span><span class="n">txt</span>  <span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
<p>will subtract the sky model from the FITS file.</p>
<p>You can also use solutions obtained by <strong>SAGECal</strong> when you restore a sky model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">restore</span> <span class="o">-</span><span class="n">f</span> <span class="n">example</span><span class="o">.</span><span class="n">fits</span> <span class="o">-</span><span class="n">i</span> <span class="n">sky</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">c</span> <span class="n">sagecal_cluster</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">l</span> <span class="n">sagecal_sky</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>will use the solution file <strong>sagecal_sky.txt</strong> and the cluster file <strong>sagecal_cluster.txt</strong> while restoring the sky model. New solution files created by <strong>SAGECal</strong> has 3 additional lines at the beginning. Newer versions (0.0.10) of restore will properly handle this.</p>
<p>As before, you can see more options by typing</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">restore</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
</div>
<div class="section" id="shapelet-gui">
<h3>shapelet_gui<a class="headerlink" href="#shapelet-gui" title="Permalink to this headline">¶</a></h3>
<p>The GUI used in decomposing FITS file to shapelets is called <strong>shapelet_gui</strong>. Once you run this program you will be seeing the GUI as in Fig. ref{shp:gui0}.</p>
<div class="figure align-center" id="id5">
<img alt="_images/shap_gui0.png" src="_images/shap_gui0.png" />
<p class="caption"><span class="caption-text">The <strong>shapelet_gui</strong> initial screen.</span></p>
</div>
<p>The essential parameters can be changed by using <strong>View-&gt;Change Options</strong> menu item. Once you select this, you will see the dialog as in Fig. ref{shp:gui1}.</p>
<div class="figure align-center" id="id7">
<img alt="_images/shap_gui1.png" src="_images/shap_gui1.png" />
<p class="caption"><span class="caption-text">The options dialog for shapelet decomposition.</span></p>
</div>
<p>We will go through the options in Fig. ref{shp:gui1} one by one.</p>
<ul class="simple">
<li><strong>Cutoff</strong> This parameter is used to select the rectangle of pixels where most of the flux in the image is concentrated. A cutoff of <span class="math">\(0.9\)</span> will select all the pixels above <span class="math">\(0.1\)</span> of the peak flux. By using cutoff of <span class="math">\(1.0\)</span>, the whole image is selected.</li>
<li><strong>max</strong> If this value is not <span class="math">\(0\)</span>, pixels above this value will be truncated to this value.</li>
<li><strong>min</strong> If this value is not <span class="math">\(0\)</span>, pixels below this value will be truncated to <span class="math">\(0\)</span>.</li>
<li><strong>Max Modes</strong> The maximum number of shapelet basis functions used. If you enter <span class="math">\(100\)</span> here, a <span class="math">\(10\times10\)</span> array of shapelet modes will be used. Use a small number here to save memory. The default value of  <span class="math">\(-1\)</span> makes the program determine this automatically.</li>
<li><strong>Scale</strong> This is the scale (or <span class="math">\(\beta\)</span>) of the shapelet basis. The default value of <span class="math">\(-1\)</span> makes the program determine this automatically.</li>
<li><strong>Use Mask</strong> Instead of using a cutoff, we can also use a mask to select the pixels for shapelet modeling. The mask can be created using <strong>Duchamp</strong>. If this option is enabled, for the image <strong>example.fits</strong> FITS file, you must have the <strong>example.MASK.fits</strong> mask file in the same location.  Note: make sure that <strong>flagMaskWithObjectNum 0</strong> is used for the input for Duchamp.</li>
<li><strong>a, b, theta</strong> These parameters are used in linear transforms. It is possible to scale and rotate your image before you do a shapelet decomposition. This is not yet implemented in BBS.</li>
<li><strong>p, q</strong> Normally, the center of the shapelet basis is selected to be the center of the FITS file. However, you can give any arbitrary location of your FITS file as the center by changing <strong>p</strong> and <strong>q</strong>. These have to be in pixels.</li>
<li><strong>Convolve modes with PSF</strong> As we mentioned before, almost all images will have a PSF. If the PSF is larger than the pixel size, it is useful to enable this option. The PSF is obtained by using the <strong>BMAJ</strong>, <strong>BMIN</strong>, <strong>BPA</strong> keywords of the FITS file.</li>
<li><strong>Use FITS PSF</strong> It is also possible to give another FITS file as the PSF. This generally has to be much smaller than the image.</li>
<li><strong>Use L1 regularized LS</strong> Instead of using normal L2 minimization to find the shapelet decomposition, you can also use L1 regularization. The difference in results is negligible in most cases.</li>
</ul>
<p>It is advised to always enable <strong>Use Mask</strong> and <strong>Convolve modes with PSF</strong> options to get best performance. You can also get more information on all these options by clicking the <strong>Help</strong> button.</p>
<p>Finally, after fine tuning your options, you can select <strong>File-&gt;Open</strong> to select your FITS file and it will produce an output like Fig. ref{shp:gui2}. If you are not satisfied with the result, you can go back and <strong>View-&gt;Change Options</strong> to re-tune your parameters. Once you have done that, you can decompose the same FITS file by selecting <strong>View-&gt;Decompose</strong> from the menu.</p>
<div class="figure align-center" id="id9">
<img alt="_images/shap_gui2.png" src="_images/shap_gui2.png" />
<p class="caption"><span class="caption-text">Output of shapelet modelling: (top left) original image (top right) shapelet modes (bottom left) residual image (bottom right) shapelet model.</span></p>
</div>
<p>Apart from displaying the output, each time you decompose a FITS file, <strong>shapelet_gui</strong> will produce several files. Most importantly, for your input <strong>example.fits</strong> image, it will produce <strong>example.fits.modes</strong> text file that can be used in BBS. Here is an extract of one such file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">23</span> <span class="mi">23</span> <span class="mf">27.273176</span> <span class="mi">58</span> <span class="mi">49</span> <span class="mf">1.217289</span>
<span class="mi">9</span> <span class="mf">1.255970e-03</span>
<span class="mi">0</span> <span class="mf">1.864041e+01</span>
<span class="mi">1</span> <span class="mf">5.311269e+00</span>
<span class="mi">2</span> <span class="mf">3.354807e+01</span>
<span class="mi">3</span> <span class="mf">7.081891e+00</span>
<span class="mi">4</span> <span class="mf">3.743916e+01</span>
<span class="mi">5</span> <span class="mf">1.209364e+01</span>
<span class="mi">6</span> <span class="mf">2.458361e+01</span>
<span class="mi">7</span> <span class="mf">7.033823e+00</span>
<span class="mi">8</span> <span class="mf">8.411157e+00</span>
<span class="o">--</span> <span class="n">many</span> <span class="n">more</span> <span class="n">rows</span> <span class="o">--</span>
<span class="c1"># BBS format:</span>
<span class="c1">## NAME shapelet  23:23:27.273176 58.49.1.217289 1.0 thisfile.fits.modes</span>
</pre></div>
</div>
<p>The thing to note from the above listing is the last line. It shows you exactly how to enter this into BBS. You have to create a text file such as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="n">FORMAT</span> <span class="o">=</span> <span class="n">Name</span> <span class="n">Type</span> <span class="n">RA</span> <span class="n">Dec</span> <span class="n">I</span> <span class="n">IShapelet</span>

<span class="n">Ex1</span> <span class="n">shapelet</span>  <span class="mi">23</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mf">27.273176</span> <span class="mf">58.49</span><span class="o">.</span><span class="mf">1.217289</span> <span class="mf">1.0</span> <span class="n">example</span><span class="o">.</span><span class="n">fits</span><span class="o">.</span><span class="n">modes</span>
</pre></div>
</div>
<p>where we have copied the last line, changing the source name to whatever we like (in this case <strong>Ex1</strong>) and changing the last field to <strong>example.fits.modes</strong>.</p>
</div>
<div class="section" id="convert-skymodel-py">
<h3>convert_skymodel.py<a class="headerlink" href="#convert-skymodel-py" title="Permalink to this headline">¶</a></h3>
<p>This script converts sky models in BBS format to LSM format and vice versa.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Usage: convert_skymodel.py [options]

Options:
  -h, --help            show this help message and exit
  -i INFILE, --infile=INFILE
                        Input sky model
  -o OUTFILE, --outfile=OUTFILE
                        Output sky model (overwritten!)
  -b, --bbstolsm        BBS to LSM
  -l, --lsmtobbs        LSM to BBS
</pre></div>
</div>
</div>
<div class="section" id="create-clusters-py">
<h3>create_clusters.py<a class="headerlink" href="#create-clusters-py" title="Permalink to this headline">¶</a></h3>
<p>This script creates a cluster file that can be used by SAGECal, given an input sky model.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span> <span class="n">create_clusters</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>

<span class="n">Options</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">s</span> <span class="n">SKYMODEL</span><span class="p">,</span> <span class="o">--</span><span class="n">skymodel</span><span class="o">=</span><span class="n">SKYMODEL</span>
                        <span class="n">Input</span> <span class="n">sky</span> <span class="n">model</span>
  <span class="o">-</span><span class="n">c</span> <span class="n">CLUSTERS</span><span class="p">,</span> <span class="o">--</span><span class="n">clusters</span><span class="o">=</span><span class="n">CLUSTERS</span>
                        <span class="n">Number</span> <span class="n">of</span> <span class="n">clusters</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">OUTFILE</span><span class="p">,</span> <span class="o">--</span><span class="n">outfile</span><span class="o">=</span><span class="n">OUTFILE</span>
                        <span class="n">Output</span> <span class="n">cluster</span> <span class="n">file</span>
  <span class="o">-</span><span class="n">i</span> <span class="n">ITERATIONS</span><span class="p">,</span> <span class="o">--</span><span class="n">iterations</span><span class="o">=</span><span class="n">ITERATIONS</span>
                        <span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span>
</pre></div>
</div>
<p>The sky model has to be in LSM format, <strong>-c</strong> option gives the number of clusters to create. It uses weighted K-means clustering algorithm, and the number of iterations for this is given by <strong>-i</strong>, usually about 10 iterations is enough for convergence. This and many other scripts can be downloaded from <strong>sagecal.sf.net</strong>.</p>
</div>
</div>
<div class="section" id="step-by-step-example">
<h2>Step by Step Example<a class="headerlink" href="#step-by-step-example" title="Permalink to this headline">¶</a></h2>
<p>In this section, we will use most of the programs described before to calibrate a LOFAR observation of Virgo-A. We will use Fig. ref{shp:viravla} (FITS file <strong>vira-cen.fits</strong>) to build the initial sky model.</p>
<div class="section" id="initial-point-source-model">
<h3>Initial point source model<a class="headerlink" href="#initial-point-source-model" title="Permalink to this headline">¶</a></h3>
<p>As we mentioned in section ref{shp:sec1}, the central compact part in Fig. ref{shp:viravla} is best modeled using point sources. Therefore, we create the following as input to <strong>Duchamp</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">imageFile</span> <span class="n">vira</span><span class="o">-</span><span class="n">cen</span><span class="o">.</span><span class="n">fits</span>
<span class="n">logFile</span>   <span class="n">logfile</span><span class="o">.</span><span class="n">txt</span>
<span class="n">outFile</span>   <span class="n">results</span><span class="o">.</span><span class="n">txt</span>
<span class="n">spectraFile</span> <span class="n">spectra</span><span class="o">.</span><span class="n">ps</span>
<span class="n">minPix</span>    <span class="mi">5</span>
<span class="n">flagATrous</span>  <span class="mi">0</span>
<span class="n">snrRecon</span>  <span class="mf">10.</span>
<span class="n">snrCut</span>    <span class="mf">5.</span>
<span class="n">threshold</span> <span class="mf">10.010</span>
<span class="n">minChannels</span> <span class="mi">3</span>
<span class="n">flagBaseline</span>    <span class="mi">0</span>
<span class="n">flagKarma</span> <span class="mi">1</span>
<span class="n">karmaFile</span> <span class="n">duchamp</span><span class="o">.</span><span class="n">ann</span>
<span class="n">flagnegative</span> <span class="mi">0</span>
<span class="n">flagMaps</span> <span class="mi">0</span>
<span class="n">flagOutputMask</span> <span class="mi">1</span>
<span class="n">flagMaskWithObjectNum</span> <span class="mi">1</span>
<span class="n">flagXOutput</span> <span class="mi">0</span>
</pre></div>
</div>
<p>After running <strong>Duchamp</strong> with this input file, we select only the bright compact center (that is the reason for using <span class="math">\(10.01\)</span> as threshold) as seen on Fig. ref{shp:viracomp}.</p>
<div class="figure align-center" id="id11">
<img alt="_images/viracomp.png" src="_images/viracomp.png" />
<p class="caption"><span class="caption-text">Compact center indicated by the red curve.</span></p>
</div>
<p>Now we run <strong>buildsky</strong> to build the sky model for this as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">buildsky</span> <span class="o">-</span><span class="n">f</span> <span class="n">vira</span><span class="o">-</span><span class="n">cen</span><span class="o">.</span><span class="n">fits</span> <span class="o">-</span><span class="n">m</span> <span class="n">vira</span><span class="o">-</span><span class="n">cen</span><span class="o">.</span><span class="n">MASK</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<p>This will create the first part of the sky model for BBS (file <strong>vira-cen.fits.sky.txt</strong>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>   <span class="c1"># (Name, Type, Ra, Dec, I, Q, U, V,</span>
<span class="n">ReferenceFrequency</span><span class="o">=</span><span class="s1">&#39;60e6&#39;</span><span class="p">,</span> <span class="n">SpectralIndexDegree</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span>
<span class="n">SpectralIndex</span><span class="p">:</span><span class="mi">0</span><span class="o">=</span><span class="s1">&#39;0.0&#39;</span><span class="p">,</span> <span class="n">MajorAxis</span><span class="p">,</span> <span class="n">MinorAxis</span><span class="p">,</span> <span class="n">Orientation</span><span class="p">)</span> <span class="o">=</span> <span class="nb">format</span>
 <span class="c1"># The above line defines the field order and is required.</span>
 <span class="n">P1C1</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">45.93</span><span class="p">,</span> <span class="o">+</span><span class="mf">12.23</span><span class="o">.</span><span class="mf">48.07</span><span class="p">,</span> <span class="mf">172.155091</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
 <span class="n">P1C2</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">47.39</span><span class="p">,</span> <span class="o">+</span><span class="mf">12.23</span><span class="o">.</span><span class="mf">51.92</span><span class="p">,</span> <span class="mf">141.518663</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
 <span class="n">P1C3</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">47.34</span><span class="p">,</span> <span class="o">+</span><span class="mf">12.23</span><span class="o">.</span><span class="mf">31.64</span><span class="p">,</span> <span class="mf">173.054910</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
 <span class="n">P1C4</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">48.90</span><span class="p">,</span> <span class="o">+</span><span class="mf">12.23</span><span class="o">.</span><span class="mf">40.67</span><span class="p">,</span> <span class="mf">177.304557</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
 <span class="n">P1C5</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">48.75</span><span class="p">,</span> <span class="o">+</span><span class="mf">12.23</span><span class="o">.</span><span class="mf">21.23</span><span class="p">,</span> <span class="mf">155.029319</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
</pre></div>
</div>
<p>Using <strong>ds9</strong> we can also see our sky model as in Fig. ref{shp:viracompds9}.</p>
<div class="figure align-center" id="id13">
<img alt="_images/viracompds9.png" src="_images/viracompds9.png" />
<p class="caption"><span class="caption-text">Compact center modeled by two point sources (green circles).</span></p>
</div>
</div>
<div class="section" id="initial-shaplet-model">
<h3>Initial shaplet model<a class="headerlink" href="#initial-shaplet-model" title="Permalink to this headline">¶</a></h3>
<p>Next, we need to model the extended structure inf Fig. ref{shp:viravla}. However, before we do this we have to subtract our point source model from this figure. We use <strong>restore</strong> to do this</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">restore</span> <span class="o">-</span><span class="n">f</span> <span class="n">vira</span><span class="o">-</span><span class="n">cen</span><span class="o">.</span><span class="n">fits</span> <span class="o">-</span><span class="n">i</span> <span class="n">vira</span><span class="o">-</span><span class="n">cen</span><span class="o">.</span><span class="n">fits</span><span class="o">.</span><span class="n">sky</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
<p>which gives us the new image as in Fig. ref{shp:viradiff}.</p>
<div class="figure align-center" id="id15">
<img alt="_images/viradiff.png" src="_images/viradiff.png" />
<p class="caption"><span class="caption-text">Diffused structure after subtracting the center.</span></p>
</div>
<p>Note that the bright central part in Fig. ref{shp:viradiff} is almost subtracted. It is not completely gone, and some parts of it is negative. Nevertheless, this is all right for now because we are only building an approximate sky model. Now we need to create another mask for this image for the diffused structure. We use to following file for <strong>Duchamp</strong>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">imageFile</span> <span class="n">vira</span><span class="o">-</span><span class="n">cen</span><span class="o">.</span><span class="n">fits</span>
<span class="n">logFile</span>   <span class="n">logfile</span><span class="o">.</span><span class="n">txt</span>
<span class="n">outFile</span>   <span class="n">results</span><span class="o">.</span><span class="n">txt</span>
<span class="n">spectraFile</span> <span class="n">spectra</span><span class="o">.</span><span class="n">ps</span>
<span class="n">minPix</span>    <span class="mi">5</span>
<span class="n">flagATrous</span>  <span class="mi">0</span>
<span class="n">snrRecon</span>  <span class="mf">10.</span>
<span class="n">snrCut</span>    <span class="mf">5.</span>
<span class="n">threshold</span> <span class="mf">1.010</span>
<span class="n">minChannels</span> <span class="mi">3</span>
<span class="n">flagBaseline</span>    <span class="mi">0</span>
<span class="n">flagKarma</span> <span class="mi">1</span>
<span class="n">karmaFile</span> <span class="n">duchamp</span><span class="o">.</span><span class="n">ann</span>
<span class="n">flagnegative</span> <span class="mi">0</span>
<span class="n">flagMaps</span> <span class="mi">0</span>
<span class="n">flagOutputMask</span> <span class="mi">1</span>
<span class="n">flagMaskWithObjectNum</span> <span class="mi">0</span>
<span class="n">flagXOutput</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Note that we have used a lower threshold (<span class="math">\(1.01\)</span>) this time, compared to the previous value. Once running <strong>Duchamp</strong>, we get the mask as indicated by Fig. ref{shp:viramaskdiff}.</p>
<div class="figure align-center" id="id17">
<img alt="_images/viramaskdiff.png" src="_images/viramaskdiff.png" />
<p class="caption"><span class="caption-text">Mask for the diffused structure.</span></p>
</div>
<p>Now we are ready to build the shapelet model. We first change some parameters using <strong>View-&gt;Change Options</strong>. We set <strong>Cutoff</strong> to <span class="math">\(1.0\)</span>, <strong>Max Modes</strong> to <span class="math">\(200\)</span>, and the center <strong>p</strong> to 75 and <strong>q</strong> to 74 to move the origin of the shapelets a bit. Furthermore, we enable <strong>Use Mask</strong> and <strong>Convolve Modes with PSF</strong> options. Then we use <strong>File-&gt;Open</strong> to select <strong>vira-cen.fits</strong> as input. After a few seconds, we get the result as in Fig. ref{shp:virashap}.</p>
<div class="figure align-center" id="id19">
<img alt="_images/virashap.png" src="_images/virashap.png" />
<p class="caption"><span class="caption-text">Shapelet model of the diffused structure.</span></p>
</div>
<p>We can easily create an input to BBS for this shapelet model as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="n">FORMAT</span> <span class="o">=</span> <span class="n">Name</span> <span class="n">Type</span> <span class="n">RA</span> <span class="n">Dec</span> <span class="n">I</span> <span class="n">IShapelet</span>

<span class="n">VirAD</span> <span class="n">shapelet</span>   <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">48.317433</span> <span class="mf">12.23</span><span class="o">.</span><span class="mf">27.999947</span> <span class="mf">1.0</span>  <span class="n">vira</span><span class="o">-</span><span class="n">cen</span><span class="o">.</span><span class="n">fits</span><span class="o">.</span><span class="n">modes</span>
</pre></div>
</div>
</div>
<div class="section" id="using-both-shapelets-and-point-sources-together">
<h3>Using both shapelets and point sources together<a class="headerlink" href="#using-both-shapelets-and-point-sources-together" title="Permalink to this headline">¶</a></h3>
<p>Here is the complete sky model using both point sources and shapelets:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># (Name, Type, Patch, Ra, Dec, I, Q, U, V, ReferenceFrequency=&#39;60e6&#39;, SpectralIndex=&#39;[0.0]&#39;, Ishapelet) = format</span>
<span class="c1"># The above line defines the field order and is required.</span>
<span class="p">,</span> <span class="p">,</span> <span class="n">CENTER</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">45.00</span><span class="p">,</span> <span class="o">+</span><span class="mf">12.23</span><span class="o">.</span><span class="mf">48.00</span>
<span class="n">P1C1</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">CENTER</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">45.93</span><span class="p">,</span> <span class="o">+</span><span class="mf">12.23</span><span class="o">.</span><span class="mf">48.07</span><span class="p">,</span> <span class="mf">172.155091</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
<span class="n">P1C2</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">CENTER</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">47.39</span><span class="p">,</span> <span class="o">+</span><span class="mf">12.23</span><span class="o">.</span><span class="mf">51.92</span><span class="p">,</span> <span class="mf">141.518663</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
<span class="n">P1C3</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">CENTER</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">47.34</span><span class="p">,</span> <span class="o">+</span><span class="mf">12.23</span><span class="o">.</span><span class="mf">31.64</span><span class="p">,</span> <span class="mf">173.054910</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
<span class="n">P1C4</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">CENTER</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">48.90</span><span class="p">,</span> <span class="o">+</span><span class="mf">12.23</span><span class="o">.</span><span class="mf">40.67</span><span class="p">,</span> <span class="mf">177.304557</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
<span class="n">P1C5</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">CENTER</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">48.75</span><span class="p">,</span> <span class="o">+</span><span class="mf">12.23</span><span class="o">.</span><span class="mf">21.23</span><span class="p">,</span> <span class="mf">155.029319</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
<span class="n">VirAD</span><span class="p">,</span> <span class="n">shapelet</span><span class="p">,</span> <span class="n">CENTER</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">48.317433</span><span class="p">,</span> <span class="mf">12.23</span><span class="o">.</span><span class="mf">27.999947</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="p">,</span> <span class="p">,</span> <span class="p">,</span>
<span class="n">vira</span><span class="o">-</span><span class="n">cen</span><span class="o">.</span><span class="n">fits</span><span class="o">.</span><span class="n">modes</span>
</pre></div>
</div>
<p>Note that the above model gives <strong>CENTER</strong> as the patch direction.</p>
</div>
<div class="section" id="simulation">
<h3>Simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h3>
<p>Once we have the point source and shapelet sky models, we can run BBS. After this is done, you are free to do whatever you like with these sky models.</p>
<p>First and foremost, it is advised to do a simulation with your sky model and the measurement set that you need to calibrate to make sure your sky model is correct. Moreover, this is also useful to check if there are any errors in flux scales. For a point source, there cannot be any error in flux. However, for an extended source, the flux will be slightly lower than your model in the image. This is because the Fourier transform preserves the integral of flux and not the peak value. So, it is urged to do a simulation first before doing any calibration. We have shown the simulated image in Fig. ref{shp:virasimul}.</p>
<div class="figure align-center" id="id21">
<img alt="_images/virasimul.png" src="_images/virasimul.png" />
<p class="caption"><span class="caption-text">Simulated image of Virgo-A. The red ellipse is the PSF.</span></p>
</div>
<div class="figure align-center" id="id23">
<img alt="_images/viracal.png" src="_images/viracal.png" />
<p class="caption"><span class="caption-text">Calibrated image of Virgo-A (uniform weights).</span></p>
</div>
<p>By looking at Fig. ref{shp:virasimul}, we do not see any major discrepancy in our sky model (although we have lower resolution) so we go ahead with calibration.</p>
</div>
<div class="section" id="calibration">
<h3>Calibration<a class="headerlink" href="#calibration" title="Permalink to this headline">¶</a></h3>
<p>You can use the normal calibration procedure you adopt with any other LOFAR observation here. So we will not go into details. We have shown the image made after calibration in Fig. ref{shp:viracal}.</p>
<p>NOTE: It is advised to use uniform weights to compare the calibrated image to the model image.</p>
<p>Using Fig. ref{shp:viracal}, we can repeat our sky model construction to get a better result. This of course depends on your science requirements.</p>
</div>
<div class="section" id="residual">
<h3>Residual<a class="headerlink" href="#residual" title="Permalink to this headline">¶</a></h3>
<p>A better way to check the accuracy of your sky model is to subtract this model from the calibrated data and make an image of the residual. In Fig. ref{shp:virares}, we have shown the residual for two subbands of 1.5 hour duration at 55 MHz. We clearly see an off center source (about 2 Jy) on top right hand corner.</p>
<div class="figure align-center" id="id25">
<img alt="_images/virares.png" src="_images/virares.png" />
<p class="caption"><span class="caption-text">Residual image of Virgo-A. An off center source is present on top right hand corner.</span></p>
</div>
</div>
<div class="section" id="recalibration">
<h3>Recalibration<a class="headerlink" href="#recalibration" title="Permalink to this headline">¶</a></h3>
<p>Once you have the residual image, you can also include to off center sources and update the sky model to re-calibrate the data.</p>
</div>
<div class="section" id="conclusions">
<h3>Conclusions<a class="headerlink" href="#conclusions" title="Permalink to this headline">¶</a></h3>
<p>We have given only a brief overview of the software and techniques in extended source modeling using shapelets. There are many points that we have not covered in this tutorial. However, we hope you (the user) will experiment and explore all available possibilities. Questions/Comments/Bug reports can be sent to <strong>yatawatta[at]astron[dot]nl</strong>.</p>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>S. Yatawatta, “Fundamental limitations of pixel based image deconvolution in radio astronomy,” <em>in proc. IEEE Sensor Array and Multichannel Signal
Processing Workshop (SAM)</em>,  Jerusalem, Israel, pp. 69–72, 2010.</li>
<li>S. Yatawatta, “Radio astronomical image deconvolution using prolate
spheroidal wave functions,” <em>IEEE International Conference on Image Processing (ICIP) 2011</em>, Brussels, Belgium, Sep. 2011.</li>
<li><ol class="first upperalpha" start="19">
<li>Yatawatta, “Shapelets and Related Techniques in Radio-Astronomical Imaging,” <em>URSI GA</em>, Istanbul, Turkey, Aug. 2011.</li>
</ol>
</li>
</ul>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>The author of this chapter is Sarod Yatawatta (<strong>yatawatta[at]astron[dot]nl</strong>).</td></tr>
</tbody>
</table>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sagecal.html" class="btn btn-neutral float-right" title="SAGECAL" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bbs.html" class="btn btn-neutral" title="Black-Board Selfcal (BBS)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Sarrvesh Sridhar.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>