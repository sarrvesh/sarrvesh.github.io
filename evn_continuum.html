

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>EVN continuum tutorial</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Sarrvesh's website
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="research.html">Research interests</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications list</a></li>
<li class="toctree-l1"><a class="reference internal" href="software.html">Software packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="dara2019.html">Development in Africa with Radio Astronomy (DARA) - Zambia 2019</a></li>
<li class="toctree-l1"><a class="reference internal" href="dara2018.html">Development in Africa with Radio Astronomy (DARA) - Mozambique 2018</a></li>
<li class="toctree-l1"><a class="reference internal" href="assorted.html">Assorted stuff</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Sarrvesh's website</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>EVN continuum tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="evn-continuum-tutorial">
<span id="evn-continuum"></span><h1>EVN continuum tutorial<a class="headerlink" href="#evn-continuum-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="objectives-of-this-tutorial">
<h2>Objectives of this tutorial<a class="headerlink" href="#objectives-of-this-tutorial" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Learn how to import data into CASA</li>
</ul>
<p><strong>Files needed for this tutorial:</strong></p>
</div>
<div class="section" id="setup-the-workspace">
<h2>Setup the workspace<a class="headerlink" href="#setup-the-workspace" title="Permalink to this headline">¶</a></h2>
<p>First create a directory and copy the above-mentioned files to this new directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir EVN
$ cp &lt;some location&gt;/* .
$ ls
n14c3_1_1.IDI1  n14c3_1_1.IDI2  n14c3.checksum  NME_DARA.tgz
$ tar xvf NME_DARA.tgz
$ ls
calibration.py                key.py           NME_3C345_skeleton.py
CASA_1848+283_J1849+3024.pdf  n14c3_1_1.IDI1   NME_all.py
CASA_Basic_EVN.pdf            n14c3_1_1.IDI2   NME_DARA.tgz
CASA_J1640+3946_3C345.pdf     n14c3.antab      NME_J1849.py
flagSH.flagcmd                n14c3.gc         README
flag_Tar1Ph1.flagcmd          NME_3C345.py.gz  tsys_spectrum.py
</pre></div>
</div>
<p><strong>n14c3_1_1.IDI1</strong> and <strong>n14c3_1_1.IDI2</strong> are FITS IDI files from the correlator that contain the raw data.</p>
</div>
<div class="section" id="data-loading-and-inspection">
<h2>Data loading and inspection<a class="headerlink" href="#data-loading-and-inspection" title="Permalink to this headline">¶</a></h2>
<p>Start CASA using the following command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ casa
</pre></div>
</div>
<p>If you are using CASA version greater than 5.0, make sure to execute the following command in CASA.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Getting help in CASA</strong>: There are different ways in which you can find documentation about CASA tasks.</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="https://casa.nrao.edu/casadocs">Online documentation</a></li>
<li>The doc() command - Opens help in a web browser</li>
<li>The help() command - Displays help inside the CASA session.</li>
</ul>
</div></blockquote>
<p><strong>Data conversion</strong>: CASA uses a file format called Measurement Sets (MS). Convert the IDI files to MS using the task <em>importfitsidi</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">importfitsidi</span><span class="p">)</span>
<span class="n">inp</span><span class="p">()</span>

<span class="n">fitsidifile</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;n14c3_1_1.IDI1&#39;</span><span class="p">,</span> <span class="s1">&#39;n14c3_1_1.IDI2&#39;</span><span class="p">]</span> <span class="c1"># Specify your input files</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3_prefix.ms&#39;</span>                              <span class="c1"># Output MS name</span>
<span class="n">constobsid</span><span class="o">=</span><span class="kc">True</span>
<span class="n">scanreindexgap_s</span><span class="o">=</span><span class="mi">15</span>                                <span class="c1"># Separate scans if gap &gt; 15s</span>
<span class="n">inp</span><span class="p">()</span>                                              <span class="c1"># Check your input</span>

<span class="n">importfitsidi</span><span class="p">()</span>                                    <span class="c1"># Execute the task</span>
</pre></div>
</div>
<p>In the logger, you might see warnings about antenna diameter and/or negative/zero scan numbers. You can ignore those warnings.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">importfitsidi</span><span class="p">)</span>
<span class="n">inp</span><span class="p">()</span>                   <span class="c1"># What do you see now? Have the parameters changed?</span>

<span class="n">tget</span><span class="p">(</span><span class="n">importfitsidi</span><span class="p">)</span>     <span class="c1"># You can also do &quot;run importfitsidi.last&quot; or execfile(&#39;importfitsidi.last&#39;)</span>
<span class="n">inp</span><span class="p">()</span>                   <span class="c1"># You&#39;ll see that the parameters have now been restored</span>
</pre></div>
</div>
<p>CASA uses the <em>importfitsidi.last</em> to store the parameters of a successfully executed task.</p>
<p><strong>What is in your MS?</strong> You can inspect the content of an MS using the task <em>listobs</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">listobs</span><span class="p">)</span>
<span class="n">inp</span><span class="p">()</span>

<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3_prefix.ms&#39;</span>
<span class="n">listobs</span><span class="p">()</span>
</pre></div>
</div>
<p>You can find the output of <em>listobs</em> in the logger. You can set <em>listfile=’n14c3_prefix.ms.listobs’</em> to redirect the output of <em>listobs</em> to the file <em>n14c3_prefix.ms.listobs</em>.</p>
<p><strong>Visualizing your data</strong>: CASA provides a number of tools to visualize the data present in your MS. For example, you can use the <em>plotants</em> task to plot the locations of the antennas.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">plotants</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3_prefix.ms&#39;</span>
<span class="n">plotants</span><span class="p">()</span>
</pre></div>
</div>
<p>You will see a plot similar to the one shown below which tells you the relative distances between the stations.</p>
<a class="reference internal image-reference" href="_images/plotants_evn.png"><img alt="_images/plotants_evn.png" class="align-center" src="_images/plotants_evn.png" style="width: 609.0px; height: 459.0px;" /></a>
<p>Another very useful CASA tool for visualizing the visibility data is the <em>plotms</em> task. There are different ways in which you can start up the plotms window. One way to do this is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">plotms</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3_prefix.ms&#39;</span>
<span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;frequency&#39;</span>
<span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;amp&#39;</span>
<span class="n">field</span><span class="o">=</span><span class="s1">&#39;1848+283&#39;</span>       <span class="c1"># specify a bright source</span>
<span class="n">avgtime</span><span class="o">=</span><span class="s1">&#39;3600&#39;</span>
<span class="n">antenna</span><span class="o">=</span><span class="s1">&#39;EF&amp;*&#39;</span>         <span class="c1"># Plot all baselines containing the antenna EF</span>
<span class="n">correlation</span><span class="o">=</span><span class="s1">&#39;RR,LL&#39;</span>    <span class="c1"># Plot only the parallel hands</span>
<span class="n">coloraxis</span><span class="o">=</span><span class="s1">&#39;antenna2&#39;</span>
<span class="n">plotms</span><span class="p">()</span>
</pre></div>
</div>
<p>You will see a new window like the one shown in the image below.</p>
<a class="reference internal image-reference" href="_images/plotms_evn.png"><img alt="_images/plotms_evn.png" class="align-center" src="_images/plotms_evn.png" style="width: 615.6px; height: 361.2px;" /></a>
<p><em>plotms</em> contains a number of knobs that can be tweaked to visualize the visibility data. Try tuning a few knobs and see what you find.</p>
</div>
<div class="section" id="correction-for-earth-rotation">
<h2>Correction for Earth rotation<a class="headerlink" href="#correction-for-earth-rotation" title="Permalink to this headline">¶</a></h2>
<p>Adjust the uvw coordinates to allow for the projection effects as the Earth rotates</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="s1">&#39;fixvis&#39;</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3_prefix.ms&#39;</span> <span class="c1"># Input MS</span>
<span class="n">outputvis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>  <span class="c1"># Output MS with correct uvw coordinates</span>
<span class="n">fixvis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="insert-the-antenna-diameters">
<h2>Insert the antenna diameters<a class="headerlink" href="#insert-the-antenna-diameters" title="Permalink to this headline">¶</a></h2>
<p>From the output of <em>listobs</em> above, we see that the individual station/antennas have 0. diameter. We can insert the diameter and some missing information about feed offsets</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ants</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EF&#39;</span><span class="p">,</span><span class="s1">&#39;WB&#39;</span><span class="p">,</span><span class="s1">&#39;JB&#39;</span><span class="p">,</span><span class="s1">&#39;ON&#39;</span><span class="p">,</span><span class="s1">&#39;NT&#39;</span><span class="p">,</span><span class="s1">&#39;TR&#39;</span><span class="p">,</span><span class="s1">&#39;SV&#39;</span><span class="p">,</span><span class="s1">&#39;ZC&#39;</span><span class="p">,</span><span class="s1">&#39;BD&#39;</span><span class="p">,</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="s1">&#39;HH&#39;</span><span class="p">,</span><span class="s1">&#39;YS&#39;</span><span class="p">,</span><span class="s1">&#39;JD&#39;</span><span class="p">]</span>
<span class="n">diams</span> <span class="o">=</span> <span class="p">[</span><span class="mf">100.0</span><span class="p">,</span><span class="mf">300.0</span><span class="p">,</span><span class="mf">75.0</span><span class="p">,</span><span class="mf">25.0</span><span class="p">,</span><span class="mf">32.0</span><span class="p">,</span><span class="mf">32.0</span><span class="p">,</span><span class="mf">32.0</span><span class="p">,</span><span class="mf">32.0</span><span class="p">,</span><span class="mf">32.0</span><span class="p">,</span><span class="mf">25.0</span><span class="p">,</span><span class="mf">24.0</span><span class="p">,</span><span class="mf">40.0</span><span class="p">,</span><span class="mf">25.0</span><span class="p">]</span>
<span class="n">axoffs</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.013</span><span class="p">,</span><span class="mf">4.95</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.15</span><span class="p">,</span><span class="mf">1.831</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="mf">0.007</span><span class="p">,</span><span class="o">-</span><span class="mf">0.008</span><span class="p">,</span><span class="o">-</span><span class="mf">0.004</span><span class="p">,</span><span class="o">-</span><span class="mf">0.002</span><span class="p">,</span><span class="mf">6.692</span><span class="p">,</span><span class="mf">2.005</span><span class="p">,</span><span class="mf">0.</span><span class="p">],[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]]</span>

<span class="c1"># We want to modify the antenna table</span>
<span class="n">tb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;n14c3.ms/ANTENNA&#39;</span><span class="p">,</span> <span class="n">nomodify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tb</span><span class="o">.</span><span class="n">putcol</span><span class="p">(</span><span class="s1">&#39;DISH_DIAMETER&#39;</span><span class="p">,</span> <span class="n">diams</span><span class="p">)</span>
<span class="n">tb</span><span class="o">.</span><span class="n">putcol</span><span class="p">(</span><span class="s1">&#39;OFFSET&#39;</span><span class="p">,</span> <span class="n">axoffs</span><span class="p">)</span>
<span class="n">tb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Verify the modifications</span>
<span class="n">default</span><span class="p">(</span><span class="n">listobs</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">listobs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="insert-tsys-table">
<h2>Insert Tsys table<a class="headerlink" href="#insert-tsys-table" title="Permalink to this headline">¶</a></h2>
<p>The file n14c3.antab contains Tsys information. However, this file is not compatible with the CASA format. So, we will use the <em>tsys_spectrum.py</em> script to convert the n14c3.antab into a CASA table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inbase</span><span class="o">=</span><span class="s1">&#39;n14c3&#39;</span>
<span class="n">execfile</span><span class="p">(</span><span class="s1">&#39;tsys_spectrum.py&#39;</span><span class="p">)</span> <span class="c1"># execfile is used to run python scripts inside CASA</span>
</pre></div>
</div>
<p>The script <em>tsys_spectrum.py</em> writes the content of the antab file into a measurement set named <em>n14c3.ms</em>. We can create the Tsys information written to this MS into a calibration table using the <em>gencal</em> task.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">gencal</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">caltable</span><span class="o">=</span><span class="s1">&#39;n14c3.tsys&#39;</span>
<span class="n">caltype</span><span class="o">=</span><span class="s1">&#39;tsys&#39;</span>
<span class="n">gencal</span><span class="p">()</span>
</pre></div>
</div>
<p>You can plot the values stored in the new table <em>n14c3.tsys</em> using the <em>plotcal</em> task.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">plotcal</span><span class="p">)</span>
<span class="n">caltable</span><span class="o">=</span><span class="s1">&#39;n14c3.tsys&#39;</span>
<span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;freq&#39;</span>
<span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;tsys&#39;</span>
<span class="n">subplot</span><span class="o">=</span><span class="mi">431</span>
<span class="n">iteration</span><span class="o">=</span><span class="s1">&#39;antenna&#39;</span>
<span class="n">plotcal</span><span class="p">()</span>
</pre></div>
</div>
<p>You should see an image similar to the one shown below.</p>
<a class="reference internal image-reference" href="_images/tsys_evn.png"><img alt="_images/tsys_evn.png" class="align-center" src="_images/tsys_evn.png" style="width: 606.0px; height: 578.0px;" /></a>
<p>Notice that three antennas (SV, ZC, and BD) do not have Tsys values. For these three stations, we will only correct for the effect of elevation based on the gains provided in the file <em>n14c3.gc</em>.</p>
</div>
<div class="section" id="flag-autocorrelations">
<h2>Flag autocorrelations<a class="headerlink" href="#flag-autocorrelations" title="Permalink to this headline">¶</a></h2>
<p>It is common practice to flag the autocorrelations present in the visibility data. You can do this using the task <em>flagdata</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">flagdata</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">mode</span><span class="o">=</span><span class="s1">&#39;manual&#39;</span>
<span class="n">autocorr</span><span class="o">=</span><span class="n">T</span>
<span class="n">flagdata</span><span class="p">()</span>
</pre></div>
</div>
<p>CASA will warn about a missing PROCESSOR sub-table. You can safely ignore the warning.</p>
</div>
<div class="section" id="backup-the-flag-table">
<h2>Backup the flag table<a class="headerlink" href="#backup-the-flag-table" title="Permalink to this headline">¶</a></h2>
<p><strong>ToDo: Explain what happens when you flag a visibility.</strong> See if you can find the flag table in casabrowser.</p>
<p>Before we do anything else, now is a good time to make a back up of the flag table. You can do this using the task <em>flagmanager</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">flagmanager</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">mode</span><span class="o">=</span><span class="s1">&#39;save&#39;</span>
<span class="n">versionname</span><span class="o">=</span><span class="s1">&#39;preSVandEndChans&#39;</span>   <span class="c1"># Use this name to restore your flag table</span>
<span class="n">flagmanager</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="preflagging">
<h2>Preflagging<a class="headerlink" href="#preflagging" title="Permalink to this headline">¶</a></h2>
<p>In this step, we will remove visibilities that we know are bad.</p>
<p><strong>Flag antenna SV</strong>: From the output of plotms above, we see that antenna SV is bad. So, let’s flag that antenna using the task <em>flagdata</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">flagdata</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">mode</span><span class="o">=</span><span class="s1">&#39;manual&#39;</span>
<span class="n">antenna</span><span class="o">=</span><span class="s1">&#39;SV&#39;</span>
<span class="n">flagdata</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Flag bad channels</strong>: You can use <em>plotms</em> to identify bad channels in your data. EF&amp;JB form the most sensitive baseline in this dataset (do you know why?). Plot the visibility amplitude as a function of nnel in <em>plotms</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">plotms</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;channel&#39;</span>
<span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;amp&#39;</span>
<span class="n">field</span><span class="o">=</span><span class="s1">&#39;1848+283&#39;</span>
<span class="n">avgtime</span><span class="o">=</span><span class="s1">&#39;3600&#39;</span>
<span class="n">antenna</span><span class="o">=</span><span class="s1">&#39;EF&amp;JB&#39;</span>
<span class="n">correlation</span><span class="o">=</span><span class="s1">&#39;RR&amp;LL&#39;</span>
<span class="n">spw</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>
<span class="n">plotms</span><span class="p">()</span>
</pre></div>
</div>
<p>In the plotms window (and in the image below), you will see that channels 0-5 and channels 29-31 are below half the maximum sensitivity.</p>
<a class="reference internal image-reference" href="_images/badchannels_spw0_evn.png"><img alt="_images/badchannels_spw0_evn.png" class="align-center" src="_images/badchannels_spw0_evn.png" style="width: 415.8px; height: 307.8px;" /></a>
<p>Now that we have identified bad channels for spw 0, can you identify bad channels in the remaining spws? Once you have identified them, you can flag these channels using <em>flagdata</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">flagdata</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">mode</span><span class="o">=</span><span class="s1">&#39;manual&#39;</span>
<span class="n">spw</span> <span class="o">=</span> <span class="s1">&#39;0:0~5;29~31,2:0~5;29~31,4:0~5;29~31,6:0~5;29~31,1:0~2;27~31,3:0~2;27~31,5:0~2;27~31,7:0~2;27~31&#39;</span>
<span class="n">flagdata</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Check for bad scans</strong>: Similar to what we did above, we can now plot the visibility as a function of time to identify time slots containing bad visibility data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">plotms</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;time&#39;</span>
<span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;amp&#39;</span>
<span class="n">field</span><span class="o">=</span><span class="s1">&#39;1848+283&#39;</span>
<span class="n">spw</span><span class="o">=</span><span class="s1">&#39;0~7:13~20&#39;</span>   <span class="c1"># Average a few central channels where the response is stable</span>
<span class="n">avgchannel</span><span class="o">=</span><span class="s1">&#39;8&#39;</span>
<span class="n">antenna</span><span class="o">=</span><span class="s1">&#39;EF&amp;*&#39;</span>
<span class="n">correlation</span><span class="o">=</span><span class="s1">&#39;RR,LL&#39;</span>
<span class="n">coloraxis</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span>
<span class="n">plotms</span><span class="p">()</span>
</pre></div>
</div>
<p>The first one or two integrations of each scan are bad. We can flag this using a specific flagdata mode called ‘quack’.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">flagdata</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">mode</span><span class="o">=</span><span class="s1">&#39;quack&#39;</span>
<span class="n">quackinterval</span><span class="o">=</span><span class="mi">5</span>
</pre></div>
</div>
<p>We also know that antenna HH is bad for scans 62-65. (Can you figure from plotms why antenna HH is bad for these scans?)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">flagdata</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">antenna</span><span class="o">=</span><span class="s1">&#39;HH&#39;</span>
<span class="n">mode</span><span class="o">=</span><span class="s1">&#39;manual&#39;</span>
<span class="n">scan</span><span class="o">=</span><span class="s1">&#39;62~65&#39;</span>
<span class="n">flagdata</span><span class="p">()</span>
</pre></div>
</div>
<p>In addition to manual flagging, you can also specify flags as a list. For example, the file <em>flagSH.flagcmd</em> contains a range of visibilities that have been identified to be bad. Have a look at the file <em>flagSH.flagcmd</em>. Once again, you can use the <em>flagdata</em> task to flag using a flag list.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">flagdata</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">mode</span><span class="o">=</span><span class="s1">&#39;list&#39;</span>      <span class="c1"># Notice the mode</span>
<span class="n">inpfile</span><span class="o">=</span><span class="s1">&#39;flagSH.flagcmd&#39;</span>
<span class="n">flagdata</span><span class="p">()</span>
</pre></div>
</div>
<p>Plot the visibility data to ensure that all bad data have been flagged. Now that we have flagged bad data, we can start calibrating our data.</p>
</div>
<div class="section" id="delay-calibration">
<h2>Delay calibration<a class="headerlink" href="#delay-calibration" title="Permalink to this headline">¶</a></h2>
<p>During observation, data recorded at each antenna is timestamped so that data from different stations can be synchronized before correlation. However, small clock errors can still be present and they can cause a frequency-dependent phase shift (i.e.) when you plot the visibility phase as a function of frequency, you will see that the phases have a non-zero slope.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">plotms</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;freq&#39;</span>
<span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;phase&#39;</span>
<span class="n">field</span><span class="o">=</span><span class="s1">&#39;1848+283&#39;</span>
<span class="n">avgtime</span><span class="o">=</span><span class="s1">&#39;3600s&#39;</span>
<span class="n">antenna</span><span class="o">=</span><span class="s1">&#39;EF&amp;*&#39;</span>
<span class="n">coloraxis</span><span class="o">=</span><span class="s1">&#39;corr&#39;</span>
<span class="n">iteraxis</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span>
<span class="n">correlation</span><span class="o">=</span><span class="s1">&#39;RR,LL&#39;</span>
<span class="n">plotms</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/phaseslope_evn.png"><img alt="_images/phaseslope_evn.png" class="align-center" src="_images/phaseslope_evn.png" style="width: 618.6px; height: 418.8px;" /></a>
<p>From the image above, we certainly see that there is a systematic slope with some random wiggle. To correct for these small clock errors, we need to determine the gradient of phase against frequency (<span class="math notranslate nohighlight">\(d\phi/d\nu\)</span>) and correct our complex visibility data.</p>
<p>If we assume that these clock errors are constant with time, we can use a single scan to derive the corrections. In this case, we will use scan 38 as it contains unflagged data for all spw and antennas. We can derive these corrections using the CASA task <em>gaincal</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">gaincal</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">caltable</span><span class="o">=</span><span class="s1">&#39;n14c3_bpcal.k&#39;</span> <span class="c1"># Name of the output calibration table</span>
<span class="n">field</span><span class="o">=</span><span class="s1">&#39;1848+283&#39;</span>
<span class="n">scan</span><span class="o">=</span><span class="s1">&#39;38&#39;</span>
<span class="n">solint</span><span class="o">=</span><span class="s1">&#39;150s&#39;</span>            <span class="c1"># This ensures that only one solution is derived.</span>
<span class="n">refant</span><span class="o">=</span><span class="s1">&#39;EF&#39;</span>
<span class="n">gaintype</span><span class="o">=</span><span class="s1">&#39;K&#39;</span>             <span class="c1"># This means solve for delay</span>
<span class="n">parang</span><span class="o">=</span><span class="n">T</span>                 <span class="c1"># This takes care of feed rotation in Alt-Az mounts</span>
</pre></div>
</div>
<p>You must always look at the derived solutions before doing anything with it. You can plot calibration solutions using the task <em>plotcal</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">plotcal</span><span class="p">)</span>
<span class="n">caltable</span><span class="o">=</span><span class="s1">&#39;n14c3_bpcal.k&#39;</span>
<span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;freq&#39;</span>
<span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;delay&#39;</span>
<span class="n">iteration</span><span class="o">=</span><span class="s1">&#39;antenna&#39;</span>
<span class="n">subplot</span><span class="o">=</span><span class="mi">431</span>
<span class="n">plotcal</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/delay_sols_evn.png"><img alt="_images/delay_sols_evn.png" class="align-center" src="_images/delay_sols_evn.png" style="width: 639.0px; height: 520.8px;" /></a>
<p>Note that for station ‘EF’, we see that the delay corrections are exactly 0 ns. Can you figure out why this is?</p>
</div>
<div class="section" id="time-dependent-phase-correction">
<h2>Time-dependent phase correction<a class="headerlink" href="#time-dependent-phase-correction" title="Permalink to this headline">¶</a></h2>
<p>For an unresolved calibrator at the phase center, the visibility phase vs. time plot should be flat.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">plotms</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;time&#39;</span>
<span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;phase&#39;</span>
<span class="n">field</span><span class="o">=</span><span class="s1">&#39;1848+283&#39;</span>
<span class="n">spw</span><span class="o">=</span><span class="s1">&#39;0~7:13~20&#39;</span>
<span class="n">avgchannel</span><span class="o">=</span><span class="s1">&#39;8&#39;</span>
<span class="n">antenna</span><span class="o">=</span><span class="s1">&#39;EF&amp;*&#39;</span>
<span class="n">coloraxis</span><span class="o">=</span><span class="s1">&#39;spw&#39;</span>
<span class="n">iteraxis</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span>
<span class="n">correlation</span><span class="o">=</span><span class="s1">&#39;RR&#39;</span>
<span class="n">plotms</span><span class="p">()</span>
</pre></div>
</div>
<p>However, the visibility phases in the image shown below are clearly not flat.</p>
<a class="reference internal image-reference" href="_images/phase_vs_time_evn.png"><img alt="_images/phase_vs_time_evn.png" class="align-center" src="_images/phase_vs_time_evn.png" style="width: 618.6px; height: 418.8px;" /></a>
<p>We will once again use the task <em>gaincal</em> to derive a correction for this. However, instead of setting gaintype=’K’ in the previous step, we will use gaintype=’G’ and calmode=’p’. These two parameters tell <em>gaincal</em> to derive time-dependent phase correction.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">gaincal</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">caltable</span><span class="o">=</span><span class="s1">&#39;n14c3_bpcal.p0&#39;</span>
<span class="n">field</span><span class="o">=</span><span class="s1">&#39;1848+283&#39;</span>
<span class="n">solint</span><span class="o">=</span><span class="s1">&#39;30s&#39;</span>
<span class="n">refant</span><span class="o">=</span><span class="s1">&#39;EF&#39;</span>
<span class="n">gaintype</span><span class="o">=</span><span class="s1">&#39;G&#39;</span>
<span class="n">calmode</span><span class="o">=</span><span class="s1">&#39;p&#39;</span>
<span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;n14c3_bpcal.k&#39;</span><span class="p">]</span>
<span class="n">interp</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span>
<span class="n">parang</span><span class="o">=</span><span class="n">T</span>
<span class="n">gaincal</span><span class="p">()</span>
</pre></div>
</div>
<p>In the gaincal task above, note that we set <strong>gaintable=[‘n14c3_bpcal.k’]</strong>. This tells gaincal to apply the delay correction derived above before deriving the new phase solutions. Plot the derived phase solutions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">plotcal</span><span class="p">)</span>
<span class="n">caltable</span><span class="o">=</span><span class="s1">&#39;n14c3_bpcal.p0&#39;</span>
<span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;time&#39;</span>
<span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;phase&#39;</span>
<span class="n">iteration</span><span class="o">=</span><span class="s1">&#39;antenna&#39;</span>
<span class="n">subplot</span><span class="o">=</span><span class="mi">431</span>
<span class="n">plotcal</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/phase_sols0_evn.png"><img alt="_images/phase_sols0_evn.png" class="align-center" src="_images/phase_sols0_evn.png" style="width: 735.6px; height: 574.8px;" /></a>
</div>
<div class="section" id="bandpass-calibration">
<h2>Bandpass calibration<a class="headerlink" href="#bandpass-calibration" title="Permalink to this headline">¶</a></h2>
<p><strong>Need to motivate why we do bandpass calibration</strong></p>
<p>To determine the bandpass corrections, we use the task <em>bandpass</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">bandpass</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">caltable</span><span class="o">=</span><span class="s1">&#39;n14c3.B&#39;</span>
<span class="n">field</span><span class="o">=</span><span class="s1">&#39;1848+283&#39;</span>
<span class="n">solint</span><span class="o">=</span><span class="s1">&#39;inf&#39;</span>
<span class="n">combine</span><span class="o">=</span><span class="s1">&#39;scan&#39;</span>
<span class="n">refant</span><span class="o">=</span><span class="s1">&#39;EF&#39;</span>
<span class="n">solnorm</span><span class="o">=</span><span class="n">T</span>
<span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;n14c3_bpcal.k&#39;</span><span class="p">,</span><span class="s1">&#39;n14c3_bpcal.p0&#39;</span><span class="p">,</span><span class="s1">&#39;n14c3.tsys&#39;</span><span class="p">,</span><span class="s1">&#39;n14c3.gc&#39;</span><span class="p">]</span>
<span class="n">interp</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span>
<span class="n">parang</span><span class="o">=</span><span class="n">T</span>
<span class="n">bandpass</span><span class="p">()</span>
</pre></div>
</div>
<p>By setting <strong>solint=’inf’</strong> and <strong>combine=’scan’</strong>, we are instructing <em>bandpass</em> to combine all scans and derive time-independent amplitude and phase corrections for each channel. Visualize the solutions using <em>plotcal</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">plotcal</span><span class="p">)</span>
<span class="n">caltable</span><span class="o">=</span><span class="s1">&#39;n14c3.B&#39;</span>
<span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;freq&#39;</span>
<span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;amp&#39;</span>          <span class="c1"># You can also set this to &#39;phase&#39;</span>
<span class="n">iteration</span><span class="o">=</span><span class="s1">&#39;antenna&#39;</span>
<span class="n">subplot</span><span class="o">=</span><span class="mi">431</span>
<span class="n">plotcal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="apply-calibration-solutions-to-the-target">
<h2>Apply calibration solutions to the target<a class="headerlink" href="#apply-calibration-solutions-to-the-target" title="Permalink to this headline">¶</a></h2>
<p>Now that we have determined the calibration solutions to account for various instrumental effects (using a calibrator source), we can now apply these corrections to the target data. We can do this using the task <em>applycal</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">applycal</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">field</span><span class="o">=</span><span class="s1">&#39;&#39;</span>          <span class="c1"># Apply the solutions to all source</span>
<span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;n14c3.tsys&#39;</span><span class="p">,</span><span class="s1">&#39;n14c3.gc&#39;</span><span class="p">,</span><span class="s1">&#39;n14c3_bpcal.k&#39;</span><span class="p">,</span><span class="s1">&#39;n14c3.B&#39;</span><span class="p">]</span>
<span class="n">interp</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span>
<span class="n">parang</span><span class="o">=</span><span class="n">T</span>
<span class="n">applymode</span><span class="o">=</span><span class="s1">&#39;calonly&#39;</span>
<span class="n">applycal</span><span class="p">()</span>
</pre></div>
</div>
<p>Notice that we are not applying the time-dependent phase corrections (n14c3_bpcal.p0) to the target. Can you guess why this is?</p>
<p>If you look at the logger carefully, you will see that applycal reports that it is “Adding CORRECTED_DATA column(s)”. This means that the applycal task has created a copy of our DATA into a new column called CORRECTED_DATA inside our measurement set and has applied the calibration solutions to this new column. This duplication of data ensures that the original data is left untouched.</p>
<p>Now, using the CORRECTED_DATA column, make the following plots for the source 1848+283:</p>
<ul class="simple">
<li>Amplitude vs. Frequency</li>
<li>Phase vs. Frequency</li>
<li>Phase vs. Time</li>
</ul>
<p>What do you see in these plots? How do they compare to the previous plots we saw above?</p>
</div>
<div class="section" id="split-out-the-target-along-with-its-phase-reference">
<h2>Split out the target along with its phase-reference<a class="headerlink" href="#split-out-the-target-along-with-its-phase-reference" title="Permalink to this headline">¶</a></h2>
<p>For convenience, let us now create two new measurement sets for each of our target along with its phase-reference source. We need to make sure that the new MS are created using the calibrated visibilities present in the CORRECTED_DATA column.</p>
<p>First, split out the source J1640+3946 along with its phase-reference calibrator 3C345</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
<span class="n">vis</span><span class="o">=</span><span class="s1">&#39;n14c3.ms&#39;</span>
<span class="n">outputvis</span><span class="o">=</span><span class="s1">&#39;J1640+3946_3C345.ms&#39;</span>
<span class="n">field</span><span class="o">=</span><span class="s1">&#39;J1640+3946,3C345&#39;</span>
<span class="n">datacolumn</span><span class="o">=</span><span class="s1">&#39;corrected&#39;</span>
<span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
<p>Next, split out the target J1849+3024 along with its phase-reference calibrator 1848+283.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">outputvis</span><span class="o">=</span><span class="s1">&#39;1848+283_J1849+3024.ms&#39;</span>
<span class="n">field</span><span class="o">=</span><span class="s1">&#39;1848+283,J1849+3024&#39;</span>
<span class="n">datacolumn</span><span class="o">=</span><span class="s1">&#39;corrected&#39;</span>
<span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
<p>This concludes the first part of the EVN Basic Continuum tutorial.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Apr 12, 2019.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

<!-- Default Statcounter code for Homepage  -->
<script type="text/javascript">
var sc_project=11432959; 
var sc_invisible=0; 
var sc_security="a33671d8"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11432959/0/a33671d8/0/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>
</html>
